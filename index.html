<!DOCTYPE html>
<html lang="sv">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Aviseringstj√§nst ‚Äì SMS & E-post</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"/>
  <style>
    body {
      background-color: #f8f9fa;
      font-family: "Segoe UI", sans-serif;
    }
    .container {
      max-width: 800px;
      background: white;
      padding: 2rem;
      margin: 3rem auto;
      border-radius: 12px;
      box-shadow: 0 0 20px rgba(0,0,0,0.1);
    }
    .loading-spinner {
      display: none;
      margin-top: 1rem;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1 class="text-primary mb-3">üì¨ Aviseringstj√§nst</h1>
    <p class="lead">Skicka SMS eller e-post via ett enkelt API-anrop. Endast <code>POST</code>-anrop med JSON st√∂ds.</p>

    <h4>üß™ Testformul√§r</h4>
    <form id="notifyForm">
      <div class="mb-3">
        <label for="action" class="form-label">Typ av utskick</label>
        <select id="action" class="form-select" required>
          <option value="sms">SMS</option>
          <option value="email">E-post</option>
        </select>
      </div>
      <div class="mb-3">
        <label for="to" class="form-label">Mottagare (<code>to</code>)</label>
        <input type="text" class="form-control" id="to" placeholder="+46701234567 eller mail@ex.se" required>
      </div>
      <div class="mb-3">
        <label for="from" class="form-label">Avs√§ndare (<code>from</code>)</label>
        <input type="text" class="form-control" id="from" placeholder="TrafikInfo eller mail@avsandare.se" required>
      </div>
      <div class="mb-3" id="subjectGroup">
        <label for="subject" class="form-label">√Ñmne (valfritt, e-post)</label>
        <input type="text" class="form-control" id="subject" placeholder="Rubrik f√∂r e-post">
      </div>
      <div class="mb-3">
        <label for="message" class="form-label">Meddelande</label>
        <textarea class="form-control" id="message" rows="3" required>Hej! Detta √§r ett test.</textarea>
      </div>
      <button type="submit" class="btn btn-success">Skicka avisering</button>
      <div class="loading-spinner" id="spinner">
        <div class="spinner-border text-primary" role="status">
          <span class="visually-hidden">Skickar...</span>
        </div>
      </div>
    </form>

    <div class="mt-4" id="responseBox"></div>

    <hr/>
    <h5>üì¶ API-anv√§ndning</h5>
    <p>Skicka ett <strong>POST</strong>-anrop till <code>/send</code> med f√∂ljande JSON:</p>
    <pre>{
  "action": "sms" eller "email",
  "to": "+46701234567" eller "e-postadress",
  "from": "TrafikInfo",
  "message": "Meddelandetext",
  "subject": "Rubrik (valfritt, endast e-post)"
}</pre>

    <p class="text-muted small mt-4">Byggd med Flask, HelloSMS och SMTP. ¬© 2025</p>
  </div>

  <script>
    const actionField = document.getElementById("action");
    const subjectGroup = document.getElementById("subjectGroup");

    actionField.addEventListener("change", () => {
      subjectGroup.style.display = actionField.value === "email" ? "block" : "none";
    });

    document.getElementById("notifyForm").addEventListener("submit", async function (e) {
      e.preventDefault();

      const action = document.getElementById("action").value;
      const to = document.getElementById("to").value;
      const from = document.getElementById("from").value;
      const subject = document.getElementById("subject").value;
      const message = document.getElementById("message").value;

      const payload = {
        action, to, from, message
      };

      if (action === "email") {
        payload.subject = subject;
      }

      const spinner = document.getElementById("spinner");
      spinner.style.display = "block";

      try {
        const res = await fetch("/send", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(payload)
        });
        const data = await res.json();
        spinner.style.display = "none";

        document.getElementById("responseBox").innerHTML = `
          <div class="alert alert-${data.status === 'success' ? 'success' : 'danger'}">
            <strong>${data.status.toUpperCase()}:</strong> ${data.response || data.error}
          </div>`;
      } catch (err) {
        spinner.style.display = "none";
        document.getElementById("responseBox").innerHTML = `
          <div class="alert alert-danger">‚ùå Ett tekniskt fel uppstod.</div>`;
      }
    });

    // Init state
    window.onload = () => {
      subjectGroup.style.display = actionField.value === "email" ? "block" : "none";
    };
  
    // Ta bort placeholder vid fokus
    ["to", "from", "subject", "message"].forEach(id => {
      const el = document.getElementById(id);
      if (el) {
        el.addEventListener("focus", () => {
          el.dataset.placeholder = el.placeholder;
          el.placeholder = "";
        });
        el.addEventListener("blur", () => {
          if (el.value === "") {
            el.placeholder = el.dataset.placeholder || "";
          }
        });
      }
    });
    </script>
</body>
</html>
